-- data populated for the integration tests
-- SQL needs to be defined in terms of autogenerated HSQL table structure, not the actual PostgreSQL tables.
-- for example column name CLIENT.IS_AUTHENTICATION, not client.isauthentication

INSERT INTO UIUSER(ID, USERNAME, LOCALE) values (1, 'testuser', null);

INSERT INTO IDENTIFIER(ID, DISCRIMINATOR, TYPE, X_ROAD_INSTANCE, MEMBER_CLASS, MEMBER_CODE, SUBSYSTEM_CODE)
values (1, 'C', 'MEMBER', 'FI', 'GOV', 'M1', null);
INSERT INTO IDENTIFIER(ID, DISCRIMINATOR, TYPE, X_ROAD_INSTANCE, MEMBER_CLASS, MEMBER_CODE, SUBSYSTEM_CODE)
values (2, 'C', 'SUBSYSTEM', 'FI', 'GOV', 'M1', 'SS1');
INSERT INTO IDENTIFIER(ID, DISCRIMINATOR, TYPE, X_ROAD_INSTANCE, MEMBER_CLASS, MEMBER_CODE, SUBSYSTEM_CODE)
values (3, 'C', 'SUBSYSTEM', 'FI', 'GOV', 'M1', 'SS2');
INSERT INTO IDENTIFIER(ID, DISCRIMINATOR, TYPE, X_ROAD_INSTANCE, GROUP_CODE)
values (4,'GG','GLOBALGROUP','FI', 'security-server-owners');
INSERT INTO IDENTIFIER(ID, DISCRIMINATOR, TYPE, GROUP_CODE)
values (5,'LG','LOCALGROUP', 'group1');
INSERT INTO IDENTIFIER(ID, DISCRIMINATOR, TYPE, GROUP_CODE)
values (6,'LG','LOCALGROUP', 'group2');
INSERT INTO IDENTIFIER(ID, DISCRIMINATOR, TYPE, X_ROAD_INSTANCE, MEMBER_CLASS, MEMBER_CODE, SUBSYSTEM_CODE)
values (7, 'C', 'SUBSYSTEM', 'FI', 'GOV', 'M2', 'SS5');
INSERT INTO IDENTIFIER(ID, DISCRIMINATOR, TYPE, X_ROAD_INSTANCE, MEMBER_CLASS, MEMBER_CODE, SUBSYSTEM_CODE)
values (8, 'C', 'SUBSYSTEM', 'FI', 'GOV', 'M2', 'SS6');
INSERT INTO IDENTIFIER(ID, DISCRIMINATOR, TYPE, X_ROAD_INSTANCE, GROUP_CODE)
values (9,'GG','GLOBALGROUP','FI', 'test-globalgroup');
INSERT INTO IDENTIFIER(ID, DISCRIMINATOR, TYPE, X_ROAD_INSTANCE, GROUP_CODE)
values (10,'GG','GLOBALGROUP','FI', 'obsolete-globalgroup');
INSERT INTO IDENTIFIER(ID, DISCRIMINATOR, TYPE, X_ROAD_INSTANCE, MEMBER_CLASS, MEMBER_CODE, SUBSYSTEM_CODE)
values (11, 'C', 'SUBSYSTEM', 'FI', 'GOV', 'M2', 'OBSOLETE-SUBSYSTEM');
INSERT INTO IDENTIFIER(ID, DISCRIMINATOR, TYPE, X_ROAD_INSTANCE, MEMBER_CLASS, MEMBER_CODE, SUBSYSTEM_CODE)
values (12, 'C', 'SUBSYSTEM', 'DUMMY', 'PRO', 'M2', 'SS6');
INSERT INTO IDENTIFIER(ID, DISCRIMINATOR, TYPE, X_ROAD_INSTANCE, MEMBER_CLASS, MEMBER_CODE, SUBSYSTEM_CODE)
values (13, 'C', 'SUBSYSTEM', 'FI', 'DUMMY', 'M2', 'SS6');


-- local clients, comment contains identifier_id, client identifier
-- 1, FI:GOV:M1
INSERT INTO CLIENT(ID, CONF_ID, IDENTIFIER, CLIENT_STATUS, IS_AUTHENTICATION)
values (1,null,1,'registered', 'NOSSL');
-- 2, FI:GOV:M1:SS1
INSERT INTO CLIENT(ID, CONF_ID, IDENTIFIER, CLIENT_STATUS, IS_AUTHENTICATION)
values (2,null,2,'registered', 'SSLNOAUTH');
-- 3, FI:GOV:M1:SS2
INSERT INTO CLIENT(ID, CONF_ID, IDENTIFIER, CLIENT_STATUS, IS_AUTHENTICATION)
values (3,null,3,'registered', 'SSLNOAUTH');
-- 7, FI:GOV:M2:SS5
INSERT INTO CLIENT(ID, CONF_ID, IDENTIFIER, CLIENT_STATUS, IS_AUTHENTICATION)
values (4,null,7,'registered', 'SSLNOAUTH');
-- 8, FI:GOV:M2:SS6
INSERT INTO CLIENT(ID, CONF_ID, IDENTIFIER, CLIENT_STATUS, IS_AUTHENTICATION)
values (5,null,8,'saved', 'SSLNOAUTH');
-- 12, DUMMY:PRO:M2:SS6
INSERT INTO CLIENT(ID, CONF_ID, IDENTIFIER, CLIENT_STATUS, IS_AUTHENTICATION)
values (6,null,12,'saved', 'SSLNOAUTH');
-- 13, FI:DUMMY:M2:SS6
INSERT INTO CLIENT(ID, CONF_ID, IDENTIFIER, CLIENT_STATUS, IS_AUTHENTICATION)
values (7,null,13,'saved', 'SSLNOAUTH');



INSERT INTO LOCALGROUP(ID, GROUP_CODE, DESCRIPTION, UPDATED, CLIENT_ID)
values (1, 'group1', 'foo', now(), 2);
INSERT INTO LOCALGROUP(ID, GROUP_CODE, DESCRIPTION, UPDATED, CLIENT_ID)
values (2, 'group2', 'foo', now(), 2);
INSERT INTO LOCALGROUP(ID, GROUP_CODE, DESCRIPTION, UPDATED, CLIENT_ID)
values (3, 'identifier-less-group', 'group-which-is-missing-identifier-for-some-reason', now(), 2);


INSERT INTO SERVERCONF(ID, server_code, OWNER) values (1, 'TEST-INMEM-SS', 1);

UPDATE CLIENT SET CONF_ID = 1;



INSERT INTO SERVICEDESCRIPTION (ID, CLIENT_ID, URL, DISABLED, DISABLED_NOTICE, REFRESHED_DATE, TYPE)
values (1, 2, 'https://soapservice.com/v1/Endpoint?wsdl', false, 'Out of order', now(), 'WSDL');
INSERT INTO SERVICEDESCRIPTION (ID, CLIENT_ID, URL, DISABLED, DISABLED_NOTICE, REFRESHED_DATE, TYPE)
values (2, 2, 'https://restservice.com/api/v1', true, 'Kaputt', now(), 'OPENAPI3');
INSERT INTO SERVICEDESCRIPTION (ID, CLIENT_ID, URL, DISABLED, DISABLED_NOTICE, REFRESHED_DATE, TYPE)
values (3, 3, 'file:src/test/resources/wsdl/testservice.wsdl', true, 'Do not use!', now(), 'WSDL');
INSERT INTO SERVICEDESCRIPTION (ID, CLIENT_ID, URL, DISABLED, DISABLED_NOTICE, REFRESHED_DATE, TYPE)
values (4, 2, 'https://soapservice.com/v1/no-services?wsdl', true, 'A WSDL without any services', now(), 'WSDL');
INSERT INTO SERVICEDESCRIPTION (ID, CLIENT_ID, URL, DISABLED, DISABLED_NOTICE, REFRESHED_DATE, TYPE)
values (5, 2, 'https://restservice.com/api/v1/nosuchservice', true, 'Single test url', now(), 'REST');
INSERT INTO SERVICEDESCRIPTION (ID, CLIENT_ID, URL, DISABLED, DISABLED_NOTICE, REFRESHED_DATE, TYPE)
values (6, 5, 'file:src/test/resources/openapiparser/valid.yaml', true, 'disabled by default', now(), 'OPENAPI3');



INSERT INTO SERVICE (ID, SERVICEDESCRIPTION_ID, SERVICE_CODE, SERVICE_VERSION, TITLE, URL, SSL_AUTHENTICATION, TIMEOUT)
values (1, 1, 'getRandom', 'v1', 'getrandom-title', 'https://soapservice.com/v1/Endpoint', true, 60);
INSERT INTO SERVICE (ID, SERVICEDESCRIPTION_ID, SERVICE_CODE, SERVICE_VERSION, TITLE, URL, SSL_AUTHENTICATION, TIMEOUT)
values (2, 1, 'calculatePrime', 'v1', 'calculatePrime-title', 'https://soapservice.com/v1/Endpoint', false, 60);
INSERT INTO SERVICE (ID, SERVICEDESCRIPTION_ID, SERVICE_CODE, SERVICE_VERSION, TITLE, URL, SSL_AUTHENTICATION, TIMEOUT)
values (3, 2, 'openapi-servicecode', 'v1', null, 'https://restservice.com/api/v1', true, 60);
INSERT INTO SERVICE (ID, SERVICEDESCRIPTION_ID, SERVICE_CODE, SERVICE_VERSION, TITLE, URL, SSL_AUTHENTICATION, TIMEOUT)
values (4, 3, 'xroadGetRandomOld', 'v1', null, 'http://xroad-lxd-web.lxd:8088/xroadGetRandom', true, 60);
INSERT INTO SERVICE (ID, SERVICEDESCRIPTION_ID, SERVICE_CODE, SERVICE_VERSION, TITLE, URL, SSL_AUTHENTICATION, TIMEOUT)
values (5, 3, 'bodyMassIndexOld', 'v1', null, 'http://xroad-lxd-web.lxd:8088/bodyMassIndex', true, 60);
INSERT INTO SERVICE (ID, SERVICEDESCRIPTION_ID, SERVICE_CODE, SERVICE_VERSION, TITLE, URL, SSL_AUTHENTICATION, TIMEOUT)
values (6, 1, 'getRandom', 'v2', 'getrandom-v2-title', 'https://soapservice.com/v1/Endpoint', true, 60);
INSERT INTO SERVICE (ID, SERVICEDESCRIPTION_ID, SERVICE_CODE, SERVICE_VERSION, TITLE, URL, SSL_AUTHENTICATION, TIMEOUT)
values (7, 5, 'rest-servicecode', null, null, 'https://restservice.com/api/v1/nosuchservice', false, 60);
INSERT INTO SERVICE (ID, SERVICEDESCRIPTION_ID, SERVICE_CODE, SERVICE_VERSION, TITLE, URL, SSL_AUTHENTICATION, TIMEOUT)
values (8, 6, 'openapi3-test', 'v1', null, 'file:src/test/resources/openapiparser/valid.yaml', false, 60);
INSERT INTO SERVICE (ID, SERVICEDESCRIPTION_ID, SERVICE_CODE, SERVICE_VERSION, TITLE, URL, SSL_AUTHENTICATION, TIMEOUT)
values (9, 1, 'serviceWithObsoleteScs', 'v1', 'service-with-obsolete-service-clients', 'https://soapservice.com/v1/Endpoint', true, 60);



INSERT INTO ENDPOINT (ID, CLIENT_ID, SERVICE_CODE, METHOD, PATH, GENERATED)
values (1, 2, 'getRandom', '*', '**', true);
INSERT INTO ENDPOINT (ID, CLIENT_ID, SERVICE_CODE, METHOD, PATH, GENERATED)
values (2, 3, 'bodyMassIndexOld', '*', '**', true);
INSERT INTO ENDPOINT (ID, CLIENT_ID, SERVICE_CODE, METHOD, PATH, GENERATED)
values (3, 2, 'calculatePrime', '*', '**', true);
INSERT INTO ENDPOINT (ID, CLIENT_ID, SERVICE_CODE, METHOD, PATH, GENERATED)
values (4, 2, 'openapi-servicecode', '*', '**', true);
INSERT INTO ENDPOINT (ID, CLIENT_ID, SERVICE_CODE, METHOD, PATH, GENERATED)
values (5, 2, 'rest-servicecode', '*', '**', true);
INSERT INTO ENDPOINT (ID, CLIENT_ID, SERVICE_CODE, METHOD, PATH, GENERATED)
values (6, 2, 'rest-servicecode', '*', '/item', false);
INSERT INTO ENDPOINT (ID, CLIENT_ID, SERVICE_CODE, METHOD, PATH, GENERATED)
values (7, 2, 'rest-servicecode', 'DELETE', '/item', false);
INSERT INTO ENDPOINT (ID, CLIENT_ID, SERVICE_CODE, METHOD, PATH, GENERATED)
values (8, 5, 'openapi3-test', '*', '**', true);
INSERT INTO ENDPOINT (ID, CLIENT_ID, SERVICE_CODE, METHOD, PATH, GENERATED)
values (9, 5, 'openapi3-test', 'GET', '/test', true);
INSERT INTO ENDPOINT (ID, CLIENT_ID, SERVICE_CODE, METHOD, PATH, GENERATED)
values (10, 5, 'openapi3-test', 'POST', '/test', true);
INSERT INTO ENDPOINT (ID, CLIENT_ID, SERVICE_CODE, METHOD, PATH, GENERATED)
values (11, 5, 'openapi3-test', 'GET', '/foo', false);
INSERT INTO ENDPOINT (ID, CLIENT_ID, SERVICE_CODE, METHOD, PATH, GENERATED)
values (12, 5, 'openapi3-test', 'PUT', '/foo', false);
INSERT INTO ENDPOINT (ID, CLIENT_ID, SERVICE_CODE, METHOD, PATH, GENERATED)
values (13, 2, 'serviceWithObsoleteScs', '*', '**', true);



INSERT INTO ACCESSRIGHT (ID, SUBJECT_ID, RIGHTS_GIVEN, CLIENT_ID, ENDPOINT_ID)
values (1, 3, {ts '2019-05-14 10:46:30.389000'}, 2, 1);
INSERT INTO ACCESSRIGHT (ID, SUBJECT_ID, RIGHTS_GIVEN, CLIENT_ID, ENDPOINT_ID)
values (2, 4, {ts '2019-05-15 10:46:30.389000'}, 2, 1);
INSERT INTO ACCESSRIGHT (ID, SUBJECT_ID, RIGHTS_GIVEN, CLIENT_ID, ENDPOINT_ID)
values (3, 5, {ts '2019-05-16 10:46:30.389000'}, 2, 1);
INSERT INTO ACCESSRIGHT (ID, SUBJECT_ID, RIGHTS_GIVEN, CLIENT_ID, ENDPOINT_ID)
values (4, 8, {ts '2019-05-16 10:46:30.389000'}, 5, 9);
INSERT INTO ACCESSRIGHT (ID, SUBJECT_ID, RIGHTS_GIVEN, CLIENT_ID, ENDPOINT_ID)
values (5, 8, {ts '2019-05-16 10:46:30.389000'}, 5, 10);
INSERT INTO ACCESSRIGHT (ID, SUBJECT_ID, RIGHTS_GIVEN, CLIENT_ID, ENDPOINT_ID)
values (6, 8, {ts '2019-05-16 10:46:30.389000'}, 5, 8);
INSERT INTO ACCESSRIGHT (ID, SUBJECT_ID, RIGHTS_GIVEN, CLIENT_ID, ENDPOINT_ID)
values (7, 8, {ts '2019-05-16 10:46:30.389000'}, 5, 11);
INSERT INTO ACCESSRIGHT (ID, SUBJECT_ID, RIGHTS_GIVEN, CLIENT_ID, ENDPOINT_ID)
values (8, 6, {ts '2020-03-05 12:04:30.389000'}, 2, 6);
INSERT INTO ACCESSRIGHT (ID, SUBJECT_ID, RIGHTS_GIVEN, CLIENT_ID, ENDPOINT_ID)
values (9, 8, {ts '2020-03-05 12:04:30.389000'}, 2, 6);
INSERT INTO ACCESSRIGHT (ID, SUBJECT_ID, RIGHTS_GIVEN, CLIENT_ID, ENDPOINT_ID)
values (10, 3, {ts '2020-03-05 12:04:30.389000'}, 2, 5);
INSERT INTO ACCESSRIGHT (ID, SUBJECT_ID, RIGHTS_GIVEN, CLIENT_ID, ENDPOINT_ID)
values (11, 3, {ts '2020-03-05 12:04:30.389000'}, 2, 6);
-- test service_client rights_given_at correct value
-- (accessright 13 has the earliest timestamp)
INSERT INTO ACCESSRIGHT (ID, SUBJECT_ID, RIGHTS_GIVEN, CLIENT_ID, ENDPOINT_ID)
values (12, 9, {ts '2020-01-01 12:01:30.000000'}, 2, 1);
INSERT INTO ACCESSRIGHT (ID, SUBJECT_ID, RIGHTS_GIVEN, CLIENT_ID, ENDPOINT_ID)
values (13, 9, {ts '2020-01-01 09:07:22.000000'}, 2, 3);
INSERT INTO ACCESSRIGHT (ID, SUBJECT_ID, RIGHTS_GIVEN, CLIENT_ID, ENDPOINT_ID)
values (14, 9, {ts '2020-01-02 12:08:30.000000'}, 2, 4);
-- access rights for obsolete global group and subsystem
INSERT INTO ACCESSRIGHT (ID, SUBJECT_ID, RIGHTS_GIVEN, CLIENT_ID, ENDPOINT_ID)
values (15, 10, {ts '2020-01-02 12:08:30.000000'}, 2, 13);
INSERT INTO ACCESSRIGHT (ID, SUBJECT_ID, RIGHTS_GIVEN, CLIENT_ID, ENDPOINT_ID)
values (16, 11, {ts '2020-01-02 12:08:30.000000'}, 2, 13);

INSERT INTO APIKEY (ID, ENCODED_KEY)
values (1, 'ad26a8235b3e847dc0b9ac34733d5acb39e2b6af634796e7eebe171165cdf2d1');

INSERT INTO APIKEY_ROLES (APIKEY_ID, ROLE)
values (1, 'XROAD_SYSTEM_ADMINISTRATOR');
INSERT INTO APIKEY_ROLES (APIKEY_ID, ROLE)
values (1, 'XROAD_SECURITY_OFFICER');
INSERT INTO APIKEY_ROLES (APIKEY_ID, ROLE)
values (1, 'XROAD_SECURITYSERVER_OBSERVER');
INSERT INTO APIKEY_ROLES (APIKEY_ID, ROLE)
values (1, 'XROAD_SERVICE_ADMINISTRATOR');
INSERT INTO APIKEY_ROLES (APIKEY_ID, ROLE)
values (1, 'XROAD_REGISTRATION_OFFICER');
